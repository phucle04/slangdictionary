package com.slangdictionary.service;

import com.slangdictionary.model.SlangDictionary;
import com.slangdictionary.model.SlangWord;
import java.io.*;
import java.nio.file.*;
import java.util.*;

public class FileService {

    public SlangDictionary loadSlangDictionary(String filePath) throws IOException {
        SlangDictionary dictionary = new SlangDictionary();

        try {

            List<String> allLines = Files.readAllLines(Paths.get(filePath));
            List<String> lines = allLines.subList(1, allLines.size());

            int lineCount = 0;
            int successCount = 0;
            int autoGeneratedCount = 0;

            for (String line : lines) {
                lineCount++;
                line = line.trim();
                if (line.isEmpty()) continue;

                boolean processed = false;

                try {
                    if (line.contains("`")) {
                        String[] parts = line.split("`", 2);
                        if (parts.length == 2) {
                            String slangWord = parts[0].trim();
                            String definitions = parts[1].trim();

                            if (!slangWord.isEmpty() && !definitions.isEmpty()) {
                                // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p c√≥ nhi·ªÅu definition ph√¢n c√°ch b·∫±ng |
                                String[] definitionList = definitions.split("\\|");

                                for (String definition : definitionList) {
                                    definition = definition.trim();
                                    if (!definition.isEmpty()) {
                                        dictionary.addSlang(slangWord, definition);
                                        successCount++;
                                    }
                                }
                                processed = true;
                            }
                        }
                    }

                    // N·∫øu kh√¥ng match format n√†o, t·∫°o slang word r·ªóng v√† d√πng c·∫£ d√≤ng l√†m definition
                    if (!processed) {
                        // T·∫°o slang word r·ªóng (c√≥ th·ªÉ d√πng empty string ho·∫∑c generate ID)
                        String autoSlangWord = generateSlangWordFromDefinition(line);
                        dictionary.addSlang(autoSlangWord, line);
                        autoGeneratedCount++;
                        System.out.println("üîß Auto-generated for line " + lineCount + ": [" + autoSlangWord + "] -> " +
                                (line.length() > 50 ? line.substring(0, 50) + "..." : line));
                    }

                } catch (Exception e) {
                    // N·∫øu c√≥ l·ªói trong x·ª≠ l√Ω, v·∫´n t·∫°o entry v·ªõi slang word r·ªóng
                    String autoSlangWord = generateSlangWordFromDefinition(line);
                    dictionary.addSlang(autoSlangWord, line);
                    autoGeneratedCount++;
                    System.err.println("‚ö†Ô∏è  Error at line " + lineCount + ", auto-generated: [" + autoSlangWord + "]");
                }
            }

            System.out.println("=== LOADING SUMMARY ===");
            System.out.println("‚úÖ Successfully processed: " + successCount + " entries");
            System.out.println("üîß Auto-generated: " + autoGeneratedCount + " entries");
            System.out.println("üìä Total slang words in dictionary: " + dictionary.getSize());

        } catch (NoSuchFileException e) {
            System.err.println("‚ùå File not found: " + filePath);
            throw e;
        } catch (IOException e) {
            System.err.println("‚ùå Error reading file: " + filePath);
            throw e;
        }

        return dictionary;
    }

    // T·∫°o slang word t·ª´ definition (c√≥ th·ªÉ t√πy ch·ªânh logic)
    private String generateSlangWordFromDefinition(String definition) {
        // M·∫∑c ƒë·ªãnh: empty string
        return "";
    }
}


